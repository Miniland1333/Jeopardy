{"version":3,"sources":["scream.js"],"names":[],"mappings":"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","file":"scream.js","sourcesContent":["import Sister from 'sister';\nimport OrientationChangeEnd from 'orientationchangeend';\n\nconst OCE = OrientationChangeEnd();\n\ntype ConfigType = {\n    width: {\n        portrait: ?number,\n        landscape: ?number\n    }\n};\n\nexport default (config: ConfigType = {}): Object => {\n    const scream = {};\n    const eventEmitter = Sister();\n\n    config.width = config.width || {};\n\n    if (!config.width.portrait) {\n        config.width.portrait = window.screen.width;\n    }\n\n    if (!config.width.landscape) {\n        config.width.landscape = window.screen.width;\n    }\n\n    /**\n     * Viewport width relative to the device orientation.\n     */\n    scream.getViewportWidth = (): number => {\n        return config.width[scream.getOrientation()];\n    };\n\n    /**\n     * Viewport height relative to the device orientation and to scale with the viewport width.\n     */\n    scream.getViewportHeight = (): number => {\n        return Math.round(scream.getScreenHeight() / scream.getScale());\n    };\n\n    /**\n     * The ratio between screen width and viewport width.\n     */\n    scream.getScale = (): number => {\n        return scream.getScreenWidth() / scream.getViewportWidth();\n    };\n\n    const OrientationType = 'portrait' | 'landscape';\n\n    scream.getOrientation = (): OrientationType => {\n        return window.orientation === 0 || window.orientation === 180 ? 'portrait' : 'landscape';\n    };\n\n    /**\n     * Screen width relative to the device orientation.\n     */\n    scream.getScreenWidth = (): number => {\n        return window.screen[scream.getOrientation() === 'portrait' ? 'width' : 'height'];\n    };\n\n    /**\n     * Screen width relative to the device orientation.\n     */\n    scream.getScreenHeight = (): number => {\n        return window.screen[scream.getOrientation() === 'portrait' ? 'height' : 'width'];\n    };\n\n    /**\n     * Generates a viewport tag reflecting the content width relative to the device orientation\n     * and scale required to fit the content in the viewport.\n     *\n     * Appends the tag to the document.head and removes the preceding additions.\n     */\n    scream.updateViewport = () => {\n        const width = scream.getViewportWidth();\n        const scale = scream.getScale();\n\n        const content =\n             'width=' + width +\n            ', initial-scale=' + scale +\n            ', minimum-scale=' + scale +\n            ', maximum-scale=' + scale +\n            ', user-scalable=0';\n\n        const viewport = document.createElement('meta');\n\n        viewport.name = 'viewport';\n        viewport.content = content;\n\n        const oldViewport = window.document.head.querySelector('meta[name=\"viewport\"]');\n\n        if (oldViewport) {\n            oldViewport.parentNode.removeChild(oldViewport);\n        }\n\n        window.document.head.appendChild(viewport);\n    };\n\n    /**\n     * @property 0 window.innerWidth when device is in a portrait orientation, scale 0.25 and page is the minimal view\n     * @property 1 window.innerHeight when device is in a portrait orientation, scale 0.25 and page is the minimal view\n     * @property 2 window.innerWidth when device is in a landscape orientation, scale 0.25 and page is the minimal view\n     * @property 3 window.innerHeight when device is in a landscape orientation, scale 0.25 and page is the minimal view\n     * @property 4 screen.width\n     * @property 5 screen.height\n     * @property 6 devicePixelRatio\n     * @property 7 name\n     */\n    type SpecType = Array;\n\n    /**\n     * Uses static device environment variables (screen.width, screen.height, devicePixelRatio) to recognize device spec.\n     */\n    scream.deviceSpec = (): SpecType => {\n        let index,\n            spec;\n\n        const specs = [\n            [1280, 1762, 1920, 1280, 320, 480, 2, 'iPhone 4'],\n            [1280, 2114, 2272, 1280, 320, 568, 2, 'iPhone 5 or 5s'],\n\n            [1500, 2510, 2668, 1500, 375, 667, 2, 'iPhone 6'],\n            // Equivalent to iPhone 5\n            // [1280, 2114, 2272, 1280, 320, 568, 2, 'iPhone 6 (Zoomed)'],\n\n            [1656, 2785, 2944, 1656, 414, 736, 3, 'iPhone 6 plus'],\n            [1500, 2509, 2668, 1500, 375, 667, 3, 'iPhone 6 plus (Zoomed)'],\n\n            [3072, 3936, 4096, 2912, 768, 1024, 1, 'iPad 2'],\n            [3072, 3938, 4096, 2914, 768, 1024, 2, 'iPad Air or Retina'],\n\n            [4096, 5306, 5464, 3938, 1024, 1366, 2, 'iPad Pro']\n        ];\n\n        index = specs.length;\n\n        while (index--) {\n            if (window.screen.width === specs[index][4] &&\n                window.screen.height === specs[index][5] &&\n                window.devicePixelRatio === specs[index][6]) {\n                spec = specs[index];\n\n                break;\n            }\n        }\n\n        return spec;\n    };\n\n    /**\n     * Returns height of the usable viewport in the minimal view relative to the current viewport width.\n     *\n     * This method will work with iOS8 only.\n     *\n     * @see http://stackoverflow.com/questions/26827822/how-is-the-window-innerheight-derived-of-the-minimal-view/26827842\n     * @see http://stackoverflow.com/questions/26801943/how-to-get-the-window-size-of-fullscream-view-when-not-in-fullscream\n     */\n    scream.getMinimalViewHeight = (): number => {\n        let height;\n\n        const orientation = scream.getOrientation();\n        const spec = scream.deviceSpec();\n\n        if (!spec) {\n            throw new Error('Not a known iOS device. If you are using an iOS device, report it to https://github.com/gajus/scream/issues/1.');\n        }\n\n        if (orientation === 'portrait') {\n            height = Math.round(scream.getViewportWidth() * spec[1] / spec[0]);\n        } else {\n            height = Math.round(scream.getViewportWidth() * spec[3] / spec[2]);\n        }\n\n        return height;\n    };\n\n    type DimensionsType = {\n        width: number,\n        height: number\n    };\n\n    /**\n     * Returns dimensions of the usable viewport in the minimal view relative to the current viewport width and orientation.\n     */\n    scream.getMinimalViewSize = (): DimensionsType => {\n        const width = scream.getViewportWidth();\n        const height = scream.getMinimalViewHeight();\n\n        return {\n            height,\n            width\n        };\n    };\n\n    /**\n     * Returns true if screen is in \"minimal\" UI.\n     *\n     * iOS 8 has removed the minimal-ui viewport property.\n     * Nevertheless, user can enter minimal-ui using touch-drag-down gesture.\n     * This method is used to detect if user is in minimal-ui view.\n     *\n     * In case of orientation change, the state of the view can be accurately\n     * determined only after orientationchangeend event.\n     */\n    scream.isMinimalView = (): boolean => {\n        // It is enough to check the height, because the viewport is based on width.\n        return window.innerHeight === scream.getMinimalViewSize().height;\n    };\n\n    /**\n     * Detect when view changes from full to minimal and vice-versa.\n     */\n    scream.detectViewChange = () => {\n        let lastView;\n\n        // This method will only with iOS 8.\n        // Overwrite the event handler to prevent an error.\n        if (!scream.deviceSpec()) {\n            /* eslint-disable no-console */\n            console.log('View change detection has been disabled. Unrecognized device. If you are using an iOS device, report it to https://github.com/gajus/scream/issues/1.');\n            /* eslint-enable */\n\n            return () => {};\n        }\n\n        return () => {\n            const currentView = scream.isMinimalView() ? 'minimal' : 'full';\n\n            if (lastView !== currentView) {\n                eventEmitter.trigger('viewchange', {\n                    viewName: currentView\n                });\n\n                lastView = currentView;\n            }\n        };\n    };\n\n    scream.detectViewChange = scream.detectViewChange();\n\n    scream.setupDOMEventListeners = () => {\n        let isOrientationChanging;\n\n        // Media matcher is the first to pick up the orientation change.\n        window\n            .matchMedia('(orientation: portrait)')\n            .addListener(() => {\n                isOrientationChanging = true;\n            });\n\n        OCE.on('orientationchangeend', () => {\n            isOrientationChanging = false;\n\n            scream.updateViewport();\n            scream.detectViewChange();\n\n            eventEmitter.trigger('orientationchangeend');\n        });\n\n        window.addEventListener('orientationchange', () => {\n            scream.updateViewport();\n        });\n\n        window.addEventListener('resize', () => {\n            if (!isOrientationChanging) {\n                scream.detectViewChange();\n            }\n        });\n\n        // iPhone 6 plus does not trigger resize event when leaving the minimal-ui in the landscape orientation.\n        window.addEventListener('scroll', () => {\n            if (!isOrientationChanging) {\n                scream.detectViewChange();\n            }\n        });\n\n        setTimeout(() => {\n            scream.detectViewChange();\n        });\n    };\n\n    scream.updateViewport();\n    scream.setupDOMEventListeners();\n\n    scream.on = eventEmitter.on;\n    scream.off = eventEmitter.off;\n\n    return scream;\n};\n"]}